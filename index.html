<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How to start your business - Final Assessment</title>
    <style>
        /* --- Fonts --- */
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap');

        /* --- Refined Neumorphic Theme --- */
        :root {
            --primary-color: #3d8bfd; /* A vibrant, modern blue */
            --primary-dark: #2a72d7;
            --secondary-color: #5b687c; /* Slate Gray for text */

            --correct-color: #27ae60; /* Green for correct answers */
            --incorrect-color: #e74c3c; /* Red for incorrect answers */

            --bg-color: #eef0f4; /* The base color for the neumorphic effect */
            --light-shadow: rgba(255, 255, 255, 0.9); /* Lighter part of the shadow */
            --dark-shadow: #c8cdd4; /* Darker part of the shadow */

            --font-en: 'Montserrat', sans-serif;
            --font-bn: 'Hind Siliguri', sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        html { scroll-behavior: smooth; }

        body {
            font-family: var(--font-en);
            background: var(--bg-color);
            color: var(--secondary-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 15px;
            overflow-x: hidden;
        }

        body.lang-bn { font-family: var(--font-bn); }

        /* --- Notification Bar --- */
        .notification-bar {
            position: fixed; top: -100px; left: 50%; transform: translateX(-50%);
            background: var(--bg-color);
            padding: 12px 25px; border-radius: 12px;
            box-shadow: 6px 6px 12px var(--dark-shadow), -6px -6px 12px var(--light-shadow);
            color: var(--incorrect-color);
            font-size: 1rem; font-weight: 600; z-index: 1000;
            transition: top 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            max-width: 90%; text-align: center;
        }
        .notification-bar.show { top: 20px; }
        .notification-bar.success { color: var(--correct-color); }

        /* --- Main Container --- */
        .quiz-container {
            background-color: var(--bg-color);
            width: 100%; max-width: 800px;
            border-radius: 30px;
            box-shadow: 15px 15px 30px var(--dark-shadow), -15px -15px 30px var(--light-shadow);
            overflow: hidden; text-align: center;
        }

        .quiz-header { padding: 20px 25px; display: flex; justify-content: flex-end; }

        /* --- Core Neumorphic Styles --- */
        .neumorphic-outset {
            border-radius: 15px;
            background: var(--bg-color);
            box-shadow: 5px 5px 10px var(--dark-shadow), -5px -5px 10px var(--light-shadow);
            transition: all 0.2s ease-in-out;
            border: none;
        }
        .neumorphic-inset {
            border-radius: 15px;
            background: var(--bg-color);
            box-shadow: inset 5px 5px 10px var(--dark-shadow), inset -5px -5px 10px var(--light-shadow);
        }

        .lang-switcher button {
            padding: 10px 18px; cursor: pointer;
            font-weight: 600; color: var(--secondary-color);
        }
        .lang-switcher button:hover { transform: translateY(-2px); }
        .lang-switcher button.active {
            color: var(--primary-color);
            box-shadow: inset 4px 4px 8px var(--dark-shadow), inset -4px -4px 8px var(--light-shadow);
        }
        .lang-switcher button:first-child { margin-right: 10px; }

        .screen { padding: 25px; animation: fadeIn 0.7s ease; }
        .screen.hidden { display: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        @keyframes shake { 0%, 100% { transform: translateX(0); } 10%, 50%, 90% { transform: translateX(-6px); } 30%, 70% { transform: translateX(6px); } }
        .invalid-field {
            animation: shake 0.4s ease-in-out;
            box-shadow: inset 3px 3px 6px #d49a94, inset -3px -3px 6px #ffc8c0 !important;
        }

        /* --- Typography --- */
        h1 { font-size: 1.8rem; font-weight: 700; margin-bottom: 20px; color: var(--primary-color); }
        h2 { font-size: 1.3rem; margin-bottom: 25px; line-height: 1.6; color: var(--secondary-color); }
        p { font-size: 1rem; margin-bottom: 20px; line-height: 1.7; color: #6c7a89; }

        /* --- Forms & Inputs --- */
        .input-group { margin-bottom: 25px; text-align: left; }
        .input-group label { font-weight: 600; display: block; margin-bottom: 10px; font-size: 0.9rem; color: var(--secondary-color); padding-left: 5px; }
        .input-group input[type="text"], .open-ended-textarea {
            width: 100%; padding: 15px;
            border: none; font-size: 1rem; font-family: inherit;
            color: var(--secondary-color); background-color: transparent;
        }
        .input-group input[type="text"]:focus, .open-ended-textarea:focus {
             outline: none;
        }
        .open-ended-textarea { min-height: 120px; resize: vertical; }

        /* --- Screenshot Upload --- */
        .screenshot-container {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
        }
        .screenshot-upload {
            flex: 1;
        }
        .screenshot-upload .upload-label {
            display: flex; align-items: center; justify-content: center;
            padding: 15px; cursor: pointer; font-weight: 500; color: var(--secondary-color);
            text-align: center;
        }
        .screenshot-upload .upload-label:hover {
            color: var(--primary-color); transform: translateY(-2px);
        }
        .screenshot-upload input[type="file"] { display: none; }

        .screenshot-upload .neumorphic-inset {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 150px;
            padding: 5px;
        }

        .screenshot-preview {
            width: 100%;
            max-height: 140px;
            object-fit: contain;
            display: none;
            border-radius: 10px;
        }
        .screenshot-preview.visible {
            display: block;
        }


        /* --- Buttons --- */
        .btn {
            padding: 15px 30px; font-size: 1rem; font-weight: 700;
            cursor: pointer; margin: 5px; text-transform: uppercase; letter-spacing: 1px;
            color: var(--secondary-color);
        }
        .btn:hover { transform: translateY(-2px); }
        .btn:active {
            transform: translateY(0);
            box-shadow: inset 5px 5px 10px var(--dark-shadow), inset -5px -5px 10px var(--light-shadow);
        }
        .btn.btn-primary {
            color: #fff; background-color: var(--primary-color);
            box-shadow: 5px 5px 10px var(--dark-shadow), -5px -5px 10px var(--light-shadow);
        }
        .btn.btn-primary:hover { background-color: var(--primary-dark); }
        .btn.btn-primary:active {
             box-shadow: inset 5px 5px 10px #2a72d7, inset -5px -5px 10px #3d8bfd;
        }
        .btn:disabled {
            box-shadow: none; color: #aaa;
            background-color: #d1d9e6;
            cursor: not-allowed; transform: none;
        }
        .btn-full { width: 100%; margin-top: 20px; }

        /* --- Quiz Screen --- */
        .progress-bar { width: 100%; height: 10px; border-radius: 5px; margin-bottom: 20px; overflow: hidden; }
        #progress-indicator { height: 100%; width: 0%; background: var(--primary-color); transition: width 0.5s ease; border-radius: 5px; }
        #progress-text { font-weight: 600; color: var(--secondary-color); margin-bottom: 20px; font-size: 0.9rem; }

        .navigation-container { display: flex; justify-content: space-between; margin-top: 20px; }

        .options-list { list-style: none; text-align: left; }
        .options-list li {
            padding: 15px; margin-bottom: 15px; cursor: pointer;
            position: relative; display: flex; align-items: center; justify-content: space-between;
            font-size: 1rem; color: var(--secondary-color);
        }
        .options-list li.selected {
             box-shadow: inset 5px 5px 10px var(--dark-shadow), inset -5px -5px 10px var(--light-shadow);
        }
        .options-list li.correct {
            font-weight: 600; color: var(--correct-color);
        }
        .options-list li.incorrect {
            font-weight: 600; color: var(--incorrect-color);
        }
        .options-list.disabled li { pointer-events: none; }
        .feedback-icon { font-size: 1.2rem; font-weight: bold; }

        /* --- Review Screen --- */
        .review-item .options-list li { cursor: default; }
        .review-item .options-list li.user-answer.incorrect {
             color: var(--incorrect-color);
             box-shadow: inset 5px 5px 10px var(--dark-shadow), inset -5px -5px 10px var(--light-shadow);
        }
        .review-item .options-list li.correct-answer {
             color: var(--correct-color);
        }

        /* --- Score Circle --- */
        .score-circle-container {
            width: 180px; height: 180px;
            margin: 20px auto;
            position: relative;
            border-radius: 50%;
        }
        .score-circle { position: relative; width: 100%; height: 100%; }
        .score-circle svg { width: 100%; height: 100%; transform: rotate(-90deg); position: absolute; top: 0; left: 0; }
        .score-circle .score-path { fill: none; stroke-width: 18; stroke-linecap: round; }
        .score-bg-path { stroke: var(--bg-color); }
        .score-progress { stroke: var(--primary-color); transition: stroke-dashoffset 1.8s ease; }
        .score-text {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 2.5rem; font-weight: 700; color: var(--primary-color);
        }

        /* --- Responsive Styles --- */
        @media (min-width: 768px) {
            h1 { font-size: 2.2rem; }
            h2 { font-size: 1.5rem; }
            .screen { padding: 40px; }
            .score-circle-container { width: 220px; height: 220px; }
            .score-text { font-size: 3.2rem; }
        }
    </style>
</head>
<body>

<div class="notification-bar" id="notification-bar"></div>

<div class="quiz-container">
    <div class="quiz-header">
        <div class="lang-switcher">
            <button id="lang-en" class="active neumorphic-outset">English</button>
            <button id="lang-bn" class="neumorphic-outset">বাংলা</button>
        </div>
    </div>

    <div class="screen" id="welcome-screen">
        <h1 id="welcome-title"></h1>
        <div class="input-group">
            <label for="userName" id="name-label"></label>
            <div class="neumorphic-inset">
                <input type="text" id="userName" required>
            </div>
        </div>
        <div class="input-group">
            <label for="mentorName" id="mentor-label"></label>
            <div class="neumorphic-inset">
                <input type="text" id="mentorName" required>
            </div>
        </div>
        <div class="screenshot-container">
            <div class="screenshot-upload">
                <p class="upload-title" id="upload-title-1"></p>
                <label class="upload-label neumorphic-outset" for="ss-upload-1" id="upload-label-1"></label>
                <input type="file" id="ss-upload-1" accept="image/*">
                <div class="neumorphic-inset">
                    <img id="ss-preview-1" class="screenshot-preview">
                </div>
            </div>
            <div class="screenshot-upload">
                <p class="upload-title" id="upload-title-2"></p>
                <label class="upload-label neumorphic-outset" for="ss-upload-2" id="upload-label-2"></label>
                <input type="file" id="ss-upload-2" accept="image/*">
                <div class="neumorphic-inset">
                    <img id="ss-preview-2" class="screenshot-preview">
                </div>
            </div>
        </div>
        <button class="btn btn-primary btn-full neumorphic-outset" id="start-btn"></button>
    </div>

    <div class="screen hidden" id="quiz-screen">
        <div id="progress-text"></div>
        <div class="progress-bar neumorphic-inset"><div id="progress-indicator"></div></div>
        <div id="q-animation-wrapper">
            <h2 id="question-text"></h2>
            <div id="options-container"></div>
        </div>
        <div class="navigation-container" id="navigation-btns">
            <button class="btn neumorphic-outset" id="prev-btn"></button>
            <button class="btn btn-primary neumorphic-outset" id="next-btn"></button>
        </div>
    </div>

    <div class="screen hidden" id="results-screen">
        <h1 id="result-heading"></h1>
        <div class="score-circle-container neumorphic-inset">
            <div class="score-circle">
                <svg viewBox="0 0 200 200">
                    <circle class="score-path score-bg-path" cx="100" cy="100" r="90"></circle>
                    <circle class="score-path score-progress" id="score-progress" cx="100" cy="100" r="90"></circle>
                </svg>
            </div>
            <div class="score-text" id="score-percentage">0%</div>
        </div>
        <p id="score-details"></p>
        <div class="results-buttons">
            <button class="btn btn-primary neumorphic-outset" id="review-btn"></button>
            <button class="btn neumorphic-outset" id="restart-btn"></button>
        </div>
    </div>

    <div class="screen hidden" id="review-screen">
        <h1 id="review-title"></h1>
        <div id="review-list"></div>
        <button class="btn btn-primary neumorphic-outset" id="back-to-results-btn"></button>
    </div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyzrjG1o7t61Edkw5GBsNUxTnb71laJSSM19PrwdE9gXOJf0bPj5-t5_ZUBvp4gBhpy/exec";

    // --- UPDATED GRADING SYSTEM ---
    const uiStrings = {
        en: {
            welcomeTitle: "How to start your business",
            nameLabel: "Your Name",
            mentorLabel: "Mentor's Name",
            namePlaceholder: "Enter your full name...",
            mentorPlaceholder: "Enter mentor's name (e.g., John Doe Sir)",
            uploadTitle1: "Start of Class",
            uploadTitle2: "End of Class",
            uploadLabel: "Click to Upload Screenshot",
            uploadSuccess: "Uploaded! Replace?",
            startBtn: "Start Quiz",
            progressText: (c, t) => `Question ${c} of ${t}`,
            prevBtn: "Previous",
            nextBtn: "Next",
            resultsBtn: "Finish & See Results",
            getResultHeading: (percentage, name) => {
                if (percentage >= 95) return `Excellent, ${name}! (A+)`;
                if (percentage >= 90) return `Great Job, ${name}! (A)`;
                if (percentage >= 85) return `Very Good, ${name}! (A-)`;
                if (percentage >= 75) return `Good Effort, ${name}! (B)`;
                if (percentage >= 65) return `Satisfactory, ${name}. (C)`;
                if (percentage >= 55) return `You've Passed, ${name}. (D)`;
                return `Needs Improvement, ${name}. (F)`;
            },
            scoreDetails: (s, t) => `You scored ${s} out of ${t} in multiple choice questions.`,
            restartBtn: "Take Quiz Again",
            reviewBtn: "Review Answers",
            reviewTitle: "Answer Review",
            backToResultsBtn: "Back to Results",
            notifyName: "Please enter your name.",
            notifyMentor: "Please enter mentor's name correctly (with Sir/Mam).",
            notifySS1: "Please upload the start of class screenshot.",
            notifySS2: "Please upload the end of class screenshot.",
            notifyDuplicateSS: "Please upload two different screenshots.",
            submissionInProgress: "Submitting...",
            submissionSuccess: "Submission Successful!",
            submissionError: "Submission Failed! Please try again.",
            openEndedPlaceholder: "Write your answer here..."
        },
        bn: {
            welcomeTitle: "আপনার ব্যবসা কিভাবে শুরু করবেন",
            nameLabel: "আপনার নাম",
            mentorLabel: "মেন্টরের নাম",
            namePlaceholder: "আপনার সম্পূর্ণ নাম লিখুন...",
            mentorPlaceholder: "মেন্টরের নাম লিখুন (যেমন, জন ডো স্যার)",
            uploadTitle1: "ক্লাসের শুরু",
            uploadTitle2: "ক্লাসের শেষ",
            uploadLabel: "স্ক্রিনশট আপলোড করুন",
            uploadSuccess: "আপলোড হয়েছে! বদলাবেন?",
            startBtn: "কুইজ শুরু করুন",
            progressText: (c, t) => `প্রশ্ন ${t}-এর মধ্যে ${c}`,
            prevBtn: "পূর্ববর্তী",
            nextBtn: "পরবর্তী",
            resultsBtn: "শেষ করুন ও ফলাফল দেখুন",
            getResultHeading: (percentage, name) => {
                if (percentage >= 95) return `অসাধারণ ফলাফল, ${name}! (A+)`;
                if (percentage >= 90) return `চমৎকার করেছেন, ${name}! (A)`;
                if (percentage >= 85) return `খুব ভালো করেছেন, ${name}! (A-)`;
                if (percentage >= 75) return `ভালো চেষ্টা, ${name}! (B)`;
                if (percentage >= 65) return `সন্তোষজনক, ${name}। (C)`;
                if (percentage >= 55) return `আপনি পাস করেছেন, ${name}। (D)`;
                return `আরও চেষ্টার প্রয়োজন, ${name}। (F)`;
            },
            scoreDetails: (s, t) => `আপনি বহুনির্বাচনী প্রশ্নগুলোর মধ্যে ${t}টির মধ্যে ${s}টি সঠিক করেছেন।`,
            restartBtn: "আবার কুইজ দিন",
            reviewBtn: "উত্তর পর্যালোচনা করুন",
            reviewTitle: "উত্তর পর্যালোচনা",
            backToResultsBtn: "ফলাফলে ফিরে যান",
            notifyName: "অনুগ্রহ করে আপনার নাম লিখুন।",
            notifyMentor: "মেন্টরের নাম সঠিকভাবে লিখুন (স্যার/ম্যাম সহ)।",
            notifySS1: "ক্লাসের শুরুর স্ক্রিনশট আপলোড করুন।",
            notifySS2: "ক্লাসের শেষের স্ক্রিনশট আপলোড করুন।",
            notifyDuplicateSS: "অনুগ্রহ করে দুটি ভিন্ন স্ক্রিনশট আপলোড করুন।",
            submissionInProgress: "জমা দেওয়া হচ্ছে...",
            submissionSuccess: "সফলভাবে জমা দেওয়া হয়েছে!",
            submissionError: "জমা দিতে ব্যর্থ! আবার চেষ্টা করুন।",
            openEndedPlaceholder: "আপনার উত্তর এখানে লিখুন..."
        }
    };
    const quizData = [
        { type: 'mcq', question: { en: "CC comes from", bn: "সিসি কোথা থেকে আসে?" }, options: { en: ['Using Products', 'Retailing Products', 'Both of the above', 'Only Joining People'], bn: ['পণ্য ব্যবহার করে', 'পণ্য বিক্রি করে', 'উপরের দুটোই', 'শুধু লোক জয়েন করিয়ে'] }, answerKey: 'Both of the above' },
        { type: 'mcq', question: { en: "What's the amount in 2CC Business Transaction", bn: "২সিসি বিজনেস ট্রানজ্যাকশনে টাকার পরিমাণ কত?" }, options: { en: ['58,320 in MRP', '55,547 in PC', "Both 'a' & 'b'", 'None of the above'], bn: ['MRP-তে ৫৮,৩২০', 'PC-তে ৫৫,৫৪৭', "'ক' এবং 'খ' উভয়ই", 'উপরের কোনোটিই নয়'] }, answerKey: "Both 'a' & 'b'" },
        { type: 'mcq', question: { en: "Why is 2CC in 'Fast Track' important?", bn: "'ফাস্ট ট্র্যাক'-এ ২সিসি করা কেন গুরুত্বপূর্ণ?" }, options: { en: ['Mentorship of Founder', 'Gateway to International Business', 'Make Passive Income', 'All of them'], bn: ['প্রতিষ্ঠাতার তত্ত্বাবধান', 'আন্তর্জাতিক ব্যবসার প্রবেশদ্বার', 'প্যাসিভ ইনকাম তৈরি', 'সবগুলো'] }, answerKey: 'All of them' },
        { type: 'mcq', question: { en: "I'm planning for 2CC in", bn: "আমি ২সিসি করার পরিকল্পনা করছি" }, options: { en: ['Fast Track', 'Medium Track', 'Slow Track', 'Not Decided Yet'], bn: ['ফাস্ট ট্র্যাকে', 'মিডিয়াম ট্র্যাকে', 'স্লো ট্র্যাকে', 'এখনও সিদ্ধান্ত নেইনি'] }, answerKey: 'Fast Track' },
        { type: 'open', question: { en: "What's your plan for 2CC business?", bn: "২সিসি ব্যবসার জন্য আপনার পরিকল্পনা কী?" } },
        { type: 'mcq', question: { en: "Growth Mindset thinks", bn: "গ্রোথ মাইন্ডসেট যা ভাবে" }, options: { en: ['I can do it anyhow', 'I can learn how', 'I accept challenges', 'All of the above'], bn: ['আমি যেভাবেই হোক এটা করতে পারি', 'আমি শিখতে পারি কিভাবে করতে হয়', 'আমি চ্যালেঞ্জ গ্রহণ করি', 'উপরের সবগুলো'] }, answerKey: 'All of the above' },
        { type: 'open', question: { en: "Is doing 2CC a Risk or a Big Opportunity? Explain.", bn: "২সিসি করা কি একটি ঝুঁকি নাকি একটি বড় সুযোগ? ব্যাখ্যা করুন।" } },
        { type: 'mcq', question: { en: "2CC business should be", bn: "২সিসি ব্যবসা হওয়া উচিত" }, options: { en: ['In home country', 'Within 2 consecutive months', 'Product Turnover', 'All of them'], bn: ['নিজ দেশে', 'টানা ২ মাসের মধ্যে', 'পণ্যের টার্নওভার', 'সবগুলো'] }, answerKey: 'All of them' },
        { type: 'open', question: { en: "By when are you committed to complete 2CC?", bn: "আপনি কখন ২সিসি সম্পন্ন করতে প্রতিশ্রুতিবদ্ধ?" } },
        { type: 'mcq', question: { en: "Can you ensure opening your business account by initial billing of 5K within 5 days?", bn: "আপনি কি ৫ দিনের মধ্যে ৫ হাজার টাকার প্রাথমিক বিলিং করে আপনার ব্যবসায়িক অ্যাকাউন্ট খোলার বিষয়টি নিশ্চিত করতে পারেন?" }, options: { en: ['Of course', 'I’ll try my best', 'I can’t', 'Need more time'], bn: ['অবশ্যই', 'আমি আমার সেরা চেষ্টা করব', 'আমি পারব না', 'আরও সময় প্রয়োজন'] }, answerKey: 'Of course' }
    ];

    let currentLanguage = 'en';
    let currentQuestionIndex = 0;
    let userAnswers = new Array(quizData.length).fill(null);
    let userName = '', mentorName = '';
    let screenshotFile1 = null, screenshotFile2 = null;
    let screenshotBase64_1 = null, screenshotBase64_2 = null;

    const body = document.body;
    const screens = { welcome: document.getElementById('welcome-screen'), quiz: document.getElementById('quiz-screen'), results: document.getElementById('results-screen'), review: document.getElementById('review-screen') };
    const notificationBar = document.getElementById('notification-bar');
    const langEnBtn = document.getElementById('lang-en'), langBnBtn = document.getElementById('lang-bn');
    const startBtn = document.getElementById('start-btn'), prevBtn = document.getElementById('prev-btn'), nextBtn = document.getElementById('next-btn');
    const restartBtn = document.getElementById('restart-btn'), reviewBtn = document.getElementById('review-btn'), backToResultsBtn = document.getElementById('back-to-results-btn');
    const userNameInput = document.getElementById('userName'), mentorNameInput = document.getElementById('mentorName');

    setLanguage('en');

    langEnBtn.addEventListener('click', () => setLanguage('en'));
    langBnBtn.addEventListener('click', () => setLanguage('bn'));
    startBtn.addEventListener('click', startQuiz);
    prevBtn.addEventListener('click', handlePrevButton);
    nextBtn.addEventListener('click', handleNextButton);
    restartBtn.addEventListener('click', restartQuiz);
    reviewBtn.addEventListener('click', () => switchScreen('review'));
    backToResultsBtn.addEventListener('click', () => switchScreen('results'));
    document.getElementById('ss-upload-1').addEventListener('change', (e) => handleFileUpload(e, 1));
    document.getElementById('ss-upload-2').addEventListener('change', (e) => handleFileUpload(e, 2));

    function setLanguage(lang) {
        currentLanguage = lang;
        body.classList.toggle('lang-bn', lang === 'bn');
        langEnBtn.classList.toggle('active', lang === 'en');
        langBnBtn.classList.toggle('active', lang === 'bn');
        updateAllUIText();
    }

    function updateAllUIText() {
        const t = uiStrings[currentLanguage];
        document.title = `${t.welcomeTitle} - Final Assessment`;
        document.getElementById('welcome-title').innerText = t.welcomeTitle;
        document.getElementById('name-label').innerText = t.nameLabel;
        document.getElementById('mentor-label').innerText = t.mentorLabel;
        userNameInput.placeholder = t.namePlaceholder;
        mentorNameInput.placeholder = t.mentorPlaceholder;
        document.getElementById('upload-label-1').innerText = screenshotFile1 ? t.uploadSuccess : t.uploadLabel;
        document.getElementById('upload-label-2').innerText = screenshotFile2 ? t.uploadSuccess : t.uploadLabel;
        document.getElementById('upload-title-1').innerText = t.uploadTitle1;
        document.getElementById('upload-title-2').innerText = t.uploadTitle2;
        startBtn.innerText = t.startBtn;
        prevBtn.innerText = t.prevBtn;
        restartBtn.innerText = t.restartBtn;
        reviewBtn.innerText = t.reviewBtn;
        document.getElementById('review-title').innerText = t.reviewTitle;
        backToResultsBtn.innerText = t.backToResultsBtn;

        if (!screens.quiz.classList.contains('hidden')) showQuestion();
        if (!screens.review.classList.contains('hidden')) buildReviewScreen();
        if (!screens.results.classList.contains('hidden')) {
            let score = 0;
            const mcqQuestions = quizData.filter(q => q.type === 'mcq');
            const totalMcq = mcqQuestions.length;
            userAnswers.forEach((answer, index) => {
                if (quizData[index].type === 'mcq' && answer === quizData[index].answerKey) score++;
            });
            const percentage = totalMcq > 0 ? Math.round((score / totalMcq) * 100) : 0;

            document.getElementById('result-heading').innerText = t.getResultHeading(percentage, userName);
            document.getElementById('score-details').innerText = t.scoreDetails(score, totalMcq);
        }
    }

    function showQuestion() {
        const qWrapper = document.getElementById('q-animation-wrapper');
        qWrapper.style.animation = 'none'; void qWrapper.offsetWidth;
        qWrapper.style.animation = 'fadeIn 0.5s ease-in-out forwards';

        const optionsContainer = document.getElementById('options-container');
        optionsContainer.innerHTML = '';

        const currentQuestion = quizData[currentQuestionIndex];
        const t = uiStrings[currentLanguage];

        document.getElementById('progress-indicator').style.width = `${((currentQuestionIndex + 1) / quizData.length) * 100}%`;
        document.getElementById('progress-text').innerText = t.progressText(currentQuestionIndex + 1, quizData.length);
        document.getElementById('question-text').innerText = currentQuestion.question[currentLanguage];

        if (currentQuestion.type === 'mcq') {
            const optionsList = document.createElement('ul');
            optionsList.className = 'options-list';
            currentQuestion.options[currentLanguage].forEach((option, index) => {
                const li = document.createElement('li');
                li.className = 'neumorphic-outset';
                const textSpan = document.createElement('span');
                textSpan.innerText = option;
                li.appendChild(textSpan);
                li.dataset.answerKey = currentQuestion.options.en[index];
                li.addEventListener('click', selectOption);
                optionsList.appendChild(li);
            });
            optionsContainer.appendChild(optionsList);
            if (userAnswers[currentQuestionIndex]) {
                showInstantFeedback();
            }
        } else if (currentQuestion.type === 'open') {
             const div = document.createElement('div');
             div.className = 'neumorphic-inset';
            const textArea = document.createElement('textarea');
            textArea.className = 'open-ended-textarea';
            textArea.placeholder = t.openEndedPlaceholder;
            textArea.value = userAnswers[currentQuestionIndex] || '';
            textArea.addEventListener('input', (e) => {
                userAnswers[currentQuestionIndex] = e.target.value;
                updateNavigation();
            });
            div.appendChild(textArea);
            optionsContainer.appendChild(div);
        }
        updateNavigation();
    }

    function selectOption(e) {
        const selectedLi = e.target.closest('li');
        const optionsList = selectedLi.parentElement;

        if (optionsList.classList.contains('disabled')) return;

        userAnswers[currentQuestionIndex] = selectedLi.dataset.answerKey;

        showInstantFeedback();
        updateNavigation();

        setTimeout(() => {
            if (currentQuestionIndex < quizData.length - 1) {
                handleNextButton();
            } else {
                showResults();
            }
        }, 800);
    }

    function showInstantFeedback() {
        const optionsList = document.querySelector('.options-list');
        if (!optionsList) return;
        optionsList.classList.add('disabled');
        const correctAnswerKey = quizData[currentQuestionIndex].answerKey;

        Array.from(optionsList.children).forEach(li => {
            li.classList.remove('neumorphic-outset');
            li.classList.add('selected');
            if(li.querySelector('.feedback-icon')) li.querySelector('.feedback-icon').remove();

            const icon = document.createElement('span');
            icon.className = 'feedback-icon';

            if (li.dataset.answerKey === correctAnswerKey) {
                li.classList.add('correct');
                icon.innerHTML = '✔';
                li.appendChild(icon);
            } else if (li.dataset.answerKey === userAnswers[currentQuestionIndex]) {
                li.classList.add('incorrect');
                icon.innerHTML = '✖';
                li.appendChild(icon);
            }
        });
    }

    function handlePrevButton() { if(currentQuestionIndex > 0) { currentQuestionIndex--; showQuestion(); } }
    function handleNextButton() {
        if (currentQuestionIndex < quizData.length - 1) {
             currentQuestionIndex++; showQuestion();
        } else {
             showResults();
        }
    }

    function updateNavigation() {
        prevBtn.disabled = currentQuestionIndex === 0;

        const currentAnswer = userAnswers[currentQuestionIndex];
        const currentQuestion = quizData[currentQuestionIndex];

        if (currentQuestion.type === 'mcq') {
            nextBtn.disabled = !currentAnswer;
        } else if (currentQuestion.type === 'open') {
            nextBtn.disabled = !currentAnswer || currentAnswer.trim() === '';
        }

        nextBtn.innerText = uiStrings[currentLanguage][currentQuestionIndex === quizData.length - 1 ? 'resultsBtn' : 'nextBtn'];
    }

    function showResults() {
        switchScreen('results');
        let score = 0;
        const mcqQuestions = quizData.filter(q => q.type === 'mcq');
        const totalMcq = mcqQuestions.length;
        userAnswers.forEach((answer, index) => {
            if (quizData[index].type === 'mcq' && answer === quizData[index].answerKey) {
                score++;
            }
        });
        const percentage = totalMcq > 0 ? Math.round((score / totalMcq) * 100) : 0;

        submitDataToSheet(score, percentage);

        const t = uiStrings[currentLanguage];
        document.getElementById('result-heading').innerText = t.getResultHeading(percentage, userName);
        document.getElementById('score-percentage').innerText = `${percentage}%`;
        document.getElementById('score-details').innerText = t.scoreDetails(score, totalMcq);

        const circle = document.getElementById('score-progress');
        const radius = circle.r.baseVal.value;
        const circumference = 2 * Math.PI * radius;

        circle.style.strokeDasharray = `${circumference} ${circumference}`;

        const offset = circumference - (percentage / 100) * circumference;
        setTimeout(() => { circle.style.strokeDashoffset = offset; }, 100);

        buildReviewScreen();
    }

    function buildReviewScreen() {
        const reviewList = document.getElementById('review-list');
        reviewList.innerHTML = '';
        quizData.forEach((q, index) => {
            const item = document.createElement('div');
            item.className = 'review-item';
            const questionText = document.createElement('h2');
            questionText.innerText = (index + 1) + '. ' + q.question[currentLanguage];
            item.appendChild(questionText);

            if (q.type === 'mcq') {
                const optionsUl = document.createElement('ul');
                optionsUl.className = 'options-list';
                q.options[currentLanguage].forEach((opt, optIndex) => {
                    const li = document.createElement('li');
                    li.className = 'neumorphic-outset';
                    const englishOptKey = q.options.en[optIndex];
                    li.innerText = opt;
                    if (englishOptKey === q.answerKey) li.classList.add('correct-answer');
                    if (englishOptKey === userAnswers[index]) {
                        li.classList.add('user-answer');
                        if (userAnswers[index] !== q.answerKey) li.classList.add('incorrect');
                    }
                    optionsUl.appendChild(li);
                });
                item.appendChild(optionsUl);
            } else if (q.type === 'open') {
                const div = document.createElement('div');
                div.className = 'neumorphic-inset';
                const answerP = document.createElement('p');
                answerP.style.padding = "15px";
                answerP.innerText = userAnswers[index] || '(No answer provided)';
                div.appendChild(answerP);
                item.appendChild(div);
            }
            reviewList.appendChild(item);
        });
    }

    function showNotification(message, isSuccess = false) {
        notificationBar.innerText = message;
        notificationBar.classList.toggle('success', isSuccess);
        notificationBar.classList.add('show');
        setTimeout(() => notificationBar.classList.remove('show'), 3000);
    }

    function triggerShake(element) {
        const parentDiv = element.parentElement;
        parentDiv.classList.add('invalid-field');
        setTimeout(() => parentDiv.classList.remove('invalid-field'), 500);
    }

    function validateWelcomeScreen() {
        const t = uiStrings[currentLanguage];
        let isValid = true;
        if (userNameInput.value.trim() === '') {
            showNotification(t.notifyName); triggerShake(userNameInput); isValid = false;
        }

        const mentorNameVal = mentorNameInput.value.trim();
        const mentorNameLower = mentorNameVal.toLowerCase();
        const validSuffixes = ['sir', 'mam', 'স্যার', 'ম্যাম'];
        const hasValidSuffix = validSuffixes.some(suffix => mentorNameLower.endsWith(` ${suffix}`) || mentorNameLower.endsWith(suffix));
        const namePart = mentorNameVal.replace(/sir|mam|স্যার|ম্যাম/gi, '').trim();
        if (namePart === '' || !hasValidSuffix) {
            showNotification(t.notifyMentor); triggerShake(mentorNameInput); isValid = false;
        }

        if (!screenshotFile1) { showNotification(t.notifySS1); triggerShake(document.getElementById('upload-label-1')); isValid = false; }
        if (!screenshotFile2) { showNotification(t.notifySS2); triggerShake(document.getElementById('upload-label-2')); isValid = false; }

        if (screenshotFile1 && screenshotFile2 && screenshotFile1.name === screenshotFile2.name && screenshotFile1.size === screenshotFile2.size) {
            showNotification(t.notifyDuplicateSS);
            triggerShake(document.getElementById('upload-label-1'));
            triggerShake(document.getElementById('upload-label-2'));
            isValid = false;
        }
        return isValid;
    }

    function handleFileUpload(e, num) {
        const file = e.target.files[0], previewEl = document.getElementById(`ss-preview-${num}`), labelEl = document.getElementById(`upload-label-${num}`);
        if (file && file.type.startsWith('image/')) {
            if(num === 1) screenshotFile1 = file; else screenshotFile2 = file;
            previewEl.src = URL.createObjectURL(file);
            previewEl.classList.add('visible');
            labelEl.innerText = uiStrings[currentLanguage].uploadSuccess;
            labelEl.classList.remove('invalid-field');

            const reader = new FileReader();
            reader.onload = function(event) {
                if (num === 1) screenshotBase64_1 = event.target.result;
                else screenshotBase64_2 = event.target.result;
            };
            reader.readAsDataURL(file);
        }
    }

    function switchScreen(screenToShow) {
        Object.values(screens).forEach(s => s.classList.add('hidden'));
        screens[screenToShow].classList.remove('hidden');
        if(screenToShow === 'review') {
            document.getElementById('review-list').scrollTop = 0;
        }
    }
    function startQuiz() { if (!validateWelcomeScreen()) return; userName = userNameInput.value.trim(); mentorName = mentorNameInput.value.trim(); switchScreen('quiz'); showQuestion(); }

    function submitDataToSheet(score, percentage) {
        const formData = new FormData();
        formData.append('UserName', userName);
        formData.append('MentorName', mentorName);
        formData.append('Score', score);
        formData.append('Percentage', percentage);

        userAnswers.forEach((answer, index) => {
            formData.append(`Q${index + 1}_Answer`, answer || 'Not Answered');
        });

        formData.append('screenshot1', screenshotBase64_1);
        formData.append('screenshot2', screenshotBase64_2);

        const submissionBtn = document.getElementById('review-btn');
        const originalText = submissionBtn.innerText;
        submissionBtn.disabled = true;
        submissionBtn.style.opacity = '0.7';
        submissionBtn.innerText = uiStrings[currentLanguage].submissionInProgress;

        fetch(SCRIPT_URL, { method: 'POST', body: formData})
            .then(response => response.json())
            .then(data => {
                if(data.result === 'success'){
                    showNotification(uiStrings[currentLanguage].submissionSuccess, true);
                } else {
                    throw new Error(data.error || 'Unknown error');
                }
            })
            .catch((error) => {
                console.error('Error:', error);
                showNotification(uiStrings[currentLanguage].submissionError);
            })
            .finally(() => {
                submissionBtn.disabled = false;
                submissionBtn.style.opacity = '1';
                submissionBtn.innerText = originalText;
            });
    }

    function restartQuiz() { window.location.reload(); }
</script>
</body>
</html>
